<div id="{{ uid }}">
	<h2>{{ tr.get('edit_gallery') }}: {{ gallery|capitalize }}</h2>
	
	{% if files|length == 0 %}
		<button class="btn btn-danger delete-gal">{{ tr.get('delete_gal') }}</button>
	{% else %}
	<form action="javascript:void(0)">
		<table class="table table-striped table-bordered">
			<thead>
				<tr>
					<th colspan="2">{{ tr.get('image') }}</th>
					<th>{{ tr.get('description') }}</th>
					<th>{{ tr.get('thumbnail') }}</th>
				</tr>
			</thead>
			
			<tbody>
				{% for file in files %}
				
				<tr>
					<td>
						<h4>{{ file.name }}</h4>
						<p><button class="btn btn-danger delete" data-file="{{ file.name }}"><i class="icon-white icon-trash"></i> {{ tr.get('delete') }}</button></p>
					</td>
					<td>
						<img src="{{ file.fullpath }}" style="max-width:300px;" />
						<pre>{{ tr.get('img_dimensions') }}: {{ file.finfo.0 }}x{{ file.finfo.1 }}px</pre>
					</td>
					
					<td>
						<textarea data-file="{{ file.name }}" style="height:100px;" name="{{ file.formattedName }}">{{ file.description }}</textarea>
						<p><button class="btn btn-success save" data-file="{{ file.name }}"><i class="icon-white icon-ok"></i> {{ tr.get('save') }}</button></p>
					</td>
					
					<td>
						<div class="img-thumb">
						{% if file.thumb %}
							<img src="{{ file.thumb }}" />
						{% endif %}
						</div>
						<button class="btn btn-info create_thumb" data-file="{{ file.name }}" data-width="{{ file.finfo.0 }}" data-height="{{ file.finfo.1 }}"><i class="icon-white icon-th-large"></i> {{ tr.get('re_create_thumb') }}</button>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</form>
	{% endif %}
	
	<hr />
	
	<div class="uploader"></div>
</div>

<script>
	new qq.FileUploader({
		element: $('#{{ uid }} div.uploader')[0],
		action: 'controller.php?obj=utils&method=upload&param[]={{ upload_dir }}',
		sizeLimit: 0,
		minSizeLimit: 0,
		onComplete: function(){
			admin.tabs.reloadActive();
		}
	});
	
	$('#{{ uid }} button.create_thumb').on('click', function(){
		var $this = $(this);
		$.post('controller.php?obj=galleries_ctrl&method=makeThumbs&param[]={{ upload_dir }}&param[]=' + $(this).data('file'), function(data){
			admin.message(data.text, data.status);
			if (data.status == 'success'){
				$this.parents('td').find('div.img-thumb').html('<img src="' + data.thumb + '" />');
				//admin.tabs.reloadActive();
			}
		}, 'json');
	});
	
	$('#{{ uid }} button.save').on('click', function(){
		$.post('controller.php?obj=galleries_ctrl&method=saveData&param[]={{ upload_dir }}', $('#{{ uid }} form').serializeArray(), function(data){
			admin.message(data.text, data.status);
		}, 'json');
	});
	
	
	$('#{{ uid }} button.delete').on('click', function(){
		$this = $(this);
		$.get('controller.php?obj=galleries_ctrl&method=deleteImg&param[]={{ upload_dir }}&param[]=' + $(this).data('file'), function(data){
			admin.message(data.text, data.status);
			
			if (data.status != 'error'){
				if ($this.parents('table').find('tr').length == 2){
					admin.tabs.reloadActive();
				} else {
					$this.parents('tr').remove();
				}
			}
		}, 'json');
	});
	
	
	$('#{{ uid }} .delete-gal').on('click', function(){
		$.get('controller.php?obj=galleries_ctrl&method=deleteGallery&param[]={{ upload_dir }}', function(data){
			admin.message(data.text, data.status);
			
			if (data.status == 'success'){
				admin.tabs.closeActive();
			}	
		}, 'json');
	});
	
</script>