<style>
ol.sortable li i.icon{
	cursor:move;
}
</style>
<div class="btn-group clearfix" style="padding:20px 0;">
	<a class="btn" href="#menu/addNew" title="Aggiungi nuovo"><i class="icon-plus"></i> {{ tr.get('add_new_menu_item') }}</a>
	<a class="btn" href="#translate/menu" title="Traduci"><i class="icon-globe"></i> {{ tr.get('translations') }}</a>
	<a class="btn reload" title="Ricarica"><i class="icon-repeat"></i> {{ tr.get('reload') }}</a>
</div>


<div class="row-fluid">
{% for menu_name, menu_data in all_menus %}

<div class="span4">
	<h3>{{ menu_name|capitalize }}</h3>
	<div class="well">
		<ol class="sortable">
			{% for item in menu_data %}
			<li id="menu_{{ item.id }}">
				<div><i class="icon icon-align-justify"></i> <a href="#menu/edit/{{ item.id }}">{{ item.item }}</a></div>
				{% if item.sub != null %}
					<ol>
						{% for sub_item in item.sub %}
						<li id="menu_{{ sub_item.id }}">
							<div><i class="icon icon-align-justify"></i> <a href="#menu/edit/{{ sub_item.id }}">{{ sub_item.item }}</a></div>
							{%if sub_item.sub != null %}
							<ol>
								{% for sub2_item in sub_item.sub %}
								<li id="menu_{{ sub2_item.id }}"><div><i class="icon icon-align-justify"></i> <a href="#menu/edit/{{ sub2_item.id }}">{{ sub2_item.item }}</a></div></li>
								{% endfor %}
							</ol>
							{% endif %}
						</li>
						{% endfor %}
					</ol>
				{% endif %}
			</li>
			{% endfor %}
		</ol>
	</div>
</div>

{% endfor %}
</div>			
			
<script>
	
	$('.sortable').nestedSortable({
		forcePlaceholderSize: true,
		handle: '.icon',
		helper: 'clone',
		items: 'li',
		maxLevels: 4,
		update: function(event, ui){
			$.post('controller.php?obj=menu_ctrl&method=nestSort', $(this).nestedSortable('serialize'), function(data){
				if(data){
					admin.message(data, 'error');
				}
			});
		}
	});
	
	$('a.reload').click(function(){
		admin.tabs.reloadActive();
		return false;
	});

</script>