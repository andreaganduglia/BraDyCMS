<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>bdus.CMS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link id="favicon" rel="shortcut icon" href="css/favicon.png" type="image/png" />

{% for f, sha in css %}
    <link rel="stylesheet" href="{{ f }}?sha256={{ sha }}">
{% endfor %}

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body{% if user_confirmed == false %} class="login"{% endif %}>

    {{ content|raw }}

  <script src="controller.php?obj=tr&method=lang2json&param[]=true"></script>
{% for f, sha in js %}
  <script src="{{ f }}?sha256={{ sha }}"></script>
{% endfor %}


{% if create_site %}
  <script>
    $('#newsite').on('submit', function(){
      $.post('./controller.php?obj=addsite_ctrl&method=build', $(this).serialize(), function(data){
        if (data.status === 'success'){
          $('#register').fadeOut();
          $('#message').fadeIn();
        } else {
          admin.message(data.text, data.status, false, true);
        }
      }, 'json');
    });
    </script>
{% else %}
  {% if user_confirmed == false %}
  {% if recaptcha %}
  <script src="https://www.google.com/recaptcha/api.js?onload=recaptchaCallback&render=explicit" async defer></script>
  <script type="text/javascript">
  if (typeof recaptchaCallback !== 'function') {
    var called = false;
    function recaptchaCallback(){
      if (called) return;
      $('.g-recaptcha').each(function(i, el){
        grecaptcha.render(el, {
          'sitekey' : $(el).data('sitekey'),
          {% if lang %} 'hl':'{{ lang }}',{% endif %}
          'callback': function(response) {
            if (response.length > 0){
              $('#login-button').prop('disabled', false);
            }
          }
        });
      });
      called = true;
    }
  }
  </script>
  {% endif %}

  <script>

    $('#signin').on('submit', function(){
      $('#logerror').hide();
      $.post('controller.php?obj=log_ctrl&method=in', $(this).serialize(), function(data){
      if (data.status === 'success'){
          location.reload();
          $(window).trigger('hashchange');
          return false;
        } else {
          {% if recaptcha %}
          grecaptcha.reset();
          {% endif %}
          $('#logerror .text').html(data.text);
          $('#logerror').show();
          $('#login-button').button('reset');
        }
      }, 'json');
    });
  </script>
{% endif %}
{% endif %}

  </body>
</html>
